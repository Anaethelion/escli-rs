.DEFAULT_GOAL := help
SHELL:=/bin/bash

.PHONY: help release

##@ Other
#------------------------------------------------------------------------------
help:  ## Display this help
	@awk 'BEGIN {FS = ":.*##"; printf "\nUsage:\n  make \033[36m<target>\033[0m\n"} /^[a-zA-Z_-]+:.*?##/ { printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2 } /^##@/ { printf "\n\033[1m%s\033[0m\n", substr($$0, 5) } ' $(MAKEFILE_LIST)
#------------- <https://www.thapaliya.com/en/writings/well-documented-makefiles/> --------------

##@ Test
#------------------------------------------------------------------------------
test: ## Run tests
	cargo test -p generator
	cargo test -p escli
#------------------------------------------------------------------------------

##@ Lint
#------------------------------------------------------------------------------
lint: ## Run linter
	cargo clippy --all-targets --all-features -- -D warnings
#------------------------------------------------------------------------------

##@ Format
#------------------------------------------------------------------------------
format: ## Format code
	cargo fmt --all
#------------------------------------------------------------------------------

##@ Clean
#------------------------------------------------------------------------------
clean: ## Clean build artifacts
	cargo clean
#------------------------------------------------------------------------------

##@ Generate
#------------------------------------------------------------------------------
generate: ## escli code generation
	cargo run -p generator --release
#------------------------------------------------------------------------------

##@ Build
#------------------------------------------------------------------------------
release: generate ## Build release
	cargo build -r -p escli
#------------------------------------------------------------------------------

##@ Release
#------------------------------------------------------------------------------
release-musl: ## Build release for testing
	cargo build -r -p escli --target x86_64-unknown-linux-musl
#------------------------------------------------------------------------------
